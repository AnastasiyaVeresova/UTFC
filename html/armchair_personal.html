<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style_menu_main.css">
    <link rel="stylesheet" href="../css/card.css">
    <script src="../script/products_lists/armchair_personal.js"></script>

    <title>Кресла для персонала</title>
</head>

<body>
    <!-- Боковое меню -->
    <div class="sidebar">
        <ul>
            <!-- <li><a href="epik.html">Epik</a></li>
            <li><a href="sofa.html">Диваны</a></li>
            <li><a href="frame.html">Каркасы</a></li>
            <li><a href="accessories.html">Комплектующие</a></li>
            <li><a href="armchair_comfort.html">Кресла Комфорт</a></li> -->
            <li><a href="armchair_personal.html">Кресла для персонала</a></li>
            <li><a href="armchair_rukovoditel.html">Кресла для руководителей</a></li>
            <li><a href="chair_cafe_and_bar.html">Стулья для кафе и бара</a></li>
            <!-- <li><a href="chair_visitors.html">Стулья для посетителей</a></li> -->
        </ul>
        <!-- Блок фильтра -->
<div class="filter-block">
    <h3>Фильтр по высоте</h3>
    <div class="range-slider">
        <input type="range" id="minHeight" min="400" max="1200" step="10" value="400">
        <input type="range" id="maxHeight" min="400" max="1200" step="10" value="1200">
        <div class="range-track"></div>
    </div>
    <div class="range-values">
        <input type="number" id="minHeightValue" min="400" max="1200" step="10" value="400">
        <span>—</span>
        <input type="number" id="maxHeightValue" min="400" max="1200" step="10" value="1200">
    </div>
</div>

    </div>
    <!-- Основной контент страницы -->
<div class="center">
    <div class="content">
        <h1>Кресла для персонала</h1>
        <div id="products"></div>
        <!-- Контейнер для сообщения "Товары не найдены" -->
        <div id="no-products-message" style="display: none;">
            <p>Товары не найдены.</p>
        </div>
    </div>
</div>

    <!-- Подключаем скрипт для загрузки карточек товаров -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const productsContainer = document.getElementById('products');
            if (!productsContainer) {
                console.error("Элемент #products не найден!");
                return;
            }
            const folderName = "armchair_personal";
            const products = [];
            const promises = knownProducts.map(productName => {
                return fetch(`../products/${folderName}/${productName}.json`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Ошибка загрузки ${productName}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(product => {
                        // Исправление: берём первый элемент массива name
                        product.namefile = product.namefile;
                        products.push(product);
                    })
                    .catch(error => {
                        console.error(`Ошибка загрузки ${productName}:`, error);
                    });
            });
            Promise.all(promises)
                .then(() => {
                    // Фильтруем только валидные товары
                    const validProducts = products.filter(p => p && p.namefile);
                    // Сортируем
                    validProducts.sort((a, b) => {
                        const aName = Array.isArray(a.namefile) ? a.namefile[0] : a.namefile;
                        const bName = Array.isArray(b.namefile) ? b.namefile[0] : b.namefile;
                        return aName.localeCompare(bName, 'ru');
                    });

                    // Генерируем карточки
validProducts.forEach(product => {
    const productName = Array.isArray(product.name) && product.name.length > 0
        ? product.name[0]
        : product.name || 'Без названия';
    const productCard = document.createElement('div');
    productCard.className = 'product-card';
    // Добавляем всплывашку с высотой
    const chairHeight = product.dimensions_details?.[0]?.chair_height;
    let tooltipText = '<strong>h</strong> не<br>указана';
    if (chairHeight) {
        const minH = chairHeight.min !== null && chairHeight.min !== undefined && chairHeight.min !== "" ? chairHeight.min : null;
        const maxH = chairHeight.max !== null && chairHeight.max !== undefined && chairHeight.max !== "" ? chairHeight.max : null;
    if (minH && maxH) {
        if (minH === maxH) {
            tooltipText = `<strong>h</strong><br>${minH}`;
        } else {
            tooltipText = `<strong>h</strong><br>${minH}-${maxH}`;
        }
    } else if (minH) {
        tooltipText = `<strong>h</strong><br>${minH}`;
    } else if (maxH) {
        tooltipText = `<strong>h</strong><br>${maxH}`;
    }
    }
        // Добавляем всплывашку с шириной
    const chairWidth = product.dimensions_details?.[0]?.seat_width_with_armrests;
    let tooltipTextWidth = '<strong>w</strong> не<br>указана';
    if (chairWidth) {
        const minW = chairWidth.min !== null && chairWidth.min !== undefined && chairWidth.min !== "" ? chairWidth.min : null;
        const maxW = chairWidth.max !== null && chairWidth.max !== undefined && chairWidth.max !== "" ? chairWidth.max : null;
        if (minW && maxW) {
            tooltipTextWidth = minW === maxW ? `<strong>w</strong><br>${minW}` : `<strong>w</strong><br>${minW}-${maxW}`;
        } else if (minW) {
            tooltipTextWidth = `<strong>w</strong><br>${minW}`;
        } else if (maxW) {
            tooltipTextWidth = `<strong>w</strong><br>${maxW}`;
        }
    }
            // Добавляем всплывашку с глубиной
    const chairDepth = product.dimensions_details?.[0]?.chair_depth;
    let tooltipTextDepth = '<strong>d</strong> не<br>указана';
    if (chairDepth) {
        const minD = chairDepth.min !== null && chairDepth.min !== undefined && chairDepth.min !== "" ? chairDepth.min : null;
        const maxD = chairDepth.max !== null && chairDepth.max !== undefined && chairDepth.max !== "" ? chairDepth.max : null;
        if (minD && maxD) {
            tooltipTextDepth = minD === maxD ? `<strong>d</strong><br>${minD}` : `<strong>d</strong><br>${minD}-${maxD}`;
        } else if (minD) {
            tooltipTextDepth = `<strong>d</strong><br>${minD}`;
        } else if (maxD) {
            tooltipTextDepth = `<strong>d</strong><br>${maxD}`;
        }
    }
    productCard.innerHTML = `
        <div class="product-tooltip">${tooltipTextWidth}<br>${tooltipTextDepth}<br>${tooltipText}</div>
        

        <img src="${product.images?.[0]?.vid_main || ''}" alt="${productName}">
        <a href="card.html?category=armchair_personal&name=${encodeURIComponent(productName)}">${productName}</a>
    `;
    productsContainer.appendChild(productCard);
});
                    if (validProducts.length === 0) {
                        productsContainer.innerHTML = '<p>Товары не найдены.</p>';
                    }
                    // --- Логика фильтрации ---
                    const minHeightInput = document.getElementById('minHeight');
                    const maxHeightInput = document.getElementById('maxHeight');
                    const minHeightValue = document.getElementById('minHeightValue');
                    const maxHeightValue = document.getElementById('maxHeightValue');
                    // Устанавливаем min/max на основе данных
                    let minPossible = Infinity;
                    let maxPossible = -Infinity;
                    validProducts.forEach(product => {
                        const chairHeight = product.dimensions_details?.[0]?.chair_height;
                        if (chairHeight) {
                            if (chairHeight.min && chairHeight.min < minPossible) minPossible = chairHeight.min;
                            if (chairHeight.max && chairHeight.max > maxPossible) maxPossible = chairHeight.max;
                        }
                    });
                    if (minPossible !== Infinity) {
                        minHeightInput.min = minPossible;
                        minHeightValue.min = minPossible;
                        minHeightInput.value = minPossible;
                        minHeightValue.value = minPossible;
                    } else {
                        minHeightInput.value = 0;
                        minHeightValue.value = 0;
                    }
                    if (maxPossible !== -Infinity) {
                        maxHeightInput.max = maxPossible;
                        maxHeightValue.max = maxPossible;
                        maxHeightInput.value = maxPossible;
                        maxHeightValue.value = maxPossible;
                    } else {
                        maxHeightInput.value = 0;
                        maxHeightValue.value = 0;
                    }
                    // Синхронизация ползунков и полей ввода
                    minHeightInput.addEventListener('input', () => {
                        if (parseInt(minHeightInput.value) > parseInt(maxHeightInput.value)) {
                            minHeightInput.value = maxHeightInput.value;
                        }
                        minHeightValue.value = minHeightInput.value;
                        filterProducts();
                    });
                    maxHeightInput.addEventListener('input', () => {
                        if (parseInt(maxHeightInput.value) < parseInt(minHeightInput.value)) {
                            maxHeightInput.value = minHeightInput.value;
                        }
                        maxHeightValue.value = maxHeightInput.value;
                        filterProducts();
                    });
                    minHeightValue.addEventListener('change', () => {
                        if (parseInt(minHeightValue.value) > parseInt(maxHeightInput.value)) {
                            minHeightValue.value = maxHeightInput.value;
                        }
                        minHeightInput.value = minHeightValue.value;
                        filterProducts();
                    });
                    maxHeightValue.addEventListener('change', () => {
                        if (parseInt(maxHeightValue.value) < parseInt(minHeightInput.value)) {
                            maxHeightValue.value = minHeightInput.value;
                        }
                        maxHeightInput.value = maxHeightValue.value;
                        filterProducts();
                    });
function filterProducts() {
    const min = parseInt(minHeightInput.value);
    const max = parseInt(maxHeightInput.value);

    const productCards = document.querySelectorAll('.product-card');
    let visibleProductsCount = 0; // Счётчик видимых товаров

    // Сначала скрываем все карточки
    productCards.forEach(card => {
        card.style.display = 'none';
    });

    // Затем проверяем, какие карточки нужно показать
    productCards.forEach(card => {
        const productName = card.querySelector('a').textContent;
        const product = validProducts.find(p => {
            const pName = Array.isArray(p.name) ? p.name[0] : p.name;
            return pName === productName;
        });

        if (!product) {
            return;
        }

        const chairHeight = product.dimensions_details?.[0]?.chair_height;
        if (!chairHeight) {
            return;
        }

        // Приводим значения высоты к числам
        const minHeight = chairHeight.min ? parseInt(chairHeight.min) : null;
        const maxHeight = chairHeight.max ? parseInt(chairHeight.max) : null;

        let isInRange = false;

        // Если указаны обе границы высоты кресла
        if (minHeight !== null && maxHeight !== null) {
            isInRange = (minHeight >= min && maxHeight <= max);
        }
        // Если указана только минимальная высота
        else if (minHeight !== null) {
            isInRange = (minHeight >= min && minHeight <= max);
        }
        // Если указана только максимальная высота
        else if (maxHeight !== null) {
            isInRange = (maxHeight >= min && maxHeight <= max);
        }

        if (isInRange) {
            card.style.display = 'inline-block';
            visibleProductsCount++;
        }
    });

    // Если нет видимых товаров, выводим сообщение
    const noProductsMessage = document.querySelector('#products > p');
    if (visibleProductsCount === 0) {
        if (!noProductsMessage) {
            productsContainer.insertAdjacentHTML('beforeend', '<p>Товары не найдены. Рекомендуем изменить условия фильтрации</p>');
        }
    } else {
        if (noProductsMessage) {
            noProductsMessage.remove();
        }
    }
}

                })
                .catch(error => {
                    console.error('Ошибка загрузки данных:', error);
                    productsContainer.innerHTML = '<p>Не удалось загрузить товары. Попробуйте позже.</p>';
                });
        });
    </script>

</body>

</html>